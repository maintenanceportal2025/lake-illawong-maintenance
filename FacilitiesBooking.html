<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Facilities - Lake Illawong</title>
    
    <style>
        /* === UNIFIED DESIGN SYSTEM v1.4 === */
        :root {
            --primary-blue: #1e40af;
            --secondary-blue: #1e3a8a;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-gray: #f8f9fa;
            --border-color: #dee2e6;
            --text-color: #333;
            --card-bg: rgba(255, 255, 255, 0.9);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header matching PasswordSettings.html EXACTLY */
        .booking-header {
            background: transparent;
            text-align: center;
            margin-bottom: 30px;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .logo-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            flex-shrink: 0;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .title-container {
            text-align: left;
        }

        .booking-header h1 {
            font-size: 2.3rem;
            font-weight: 700;
            color: white;
            margin-top: 30px;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .booking-header p {
            color: white;
            font-size: .9rem;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .header-divider {
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 10%, rgba(255,255,255,0.8) 50%, rgba(255,255,255,0.3) 90%, transparent 100%);
            margin: 10px 0 40px 0;
            border-radius: 1.5px;
        }
        
        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Card styling */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }
        
        .card h2 {
            color: var(--primary-blue);
            font-size: 1.6rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        /* Form Grid */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        /* Form Groups */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary-blue);
            font-size: 1rem;
        }
        
        .form-group.required label::after {
            content: " *";
            color: var(--danger-color);
        }
        
        /* Input Styling */
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="time"],
        input[type="password"],
        select,
        textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        /* Time Slot Selection */
        .time-slots {
            display: grid;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }
        
        .time-slot {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .time-slot:hover {
            border-color: var(--accent-color);
            background: var(--light-gray);
        }
        
        .time-slot.selected {
            border-color: var(--success-color);
            background: #f0f9f4;
        }
        
        .time-slot input {
            width: auto;
            margin-right: 1rem;
            transform: scale(1.2);
        }
        
        /* Button Styling */
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            text-align: center;
            font-family: inherit;
        }
        
        .btn-primary {
            background: var(--accent-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .btn-large {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }
        
        .btn-full {
            width: 100%;
        }
        
        /* Button Group */
        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        /* Messages */
        .message {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: none;
            border-left: 4px solid;
        }
        
        .message-success {
            background: #d4edda;
            border-color: var(--success-color);
            color: #155724;
        }
        
        .message-error {
            background: #f8d7da;
            border-color: var(--danger-color);
            color: #721c24;
        }
        
        .message-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        
        /* Loading Indicator */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 0;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 1rem 1.75rem;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 12px 12px 0 0;
            font-weight: 700;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.85);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-width: 120px;
            backdrop-filter: blur(5px);
            border-bottom: 3px solid transparent;
            position: relative;
            bottom: -1px;
        }
        
        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .nav-tab.active {
            background: var(--card-bg);
            color: var(--primary-blue);
            border-bottom: 3px solid var(--accent-color);
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08);
            position: relative;
            z-index: 10;
        }
        
        /* Tab icons */
        .nav-tab::before {
            content: '';
            display: inline-block;
            margin-right: 0.5rem;
            font-size: 1.2em;
            vertical-align: middle;
        }
        
        .nav-tab:nth-child(1)::before { content: 'üìÖ'; }
        .nav-tab:nth-child(2)::before { content: 'üìã'; }
        .nav-tab:nth-child(3)::before { content: 'üóìÔ∏è'; }
        .nav-tab:nth-child(4)::before { content: 'üìò'; }
        .nav-tab:nth-child(5)::before { content: 'üõ†Ô∏è'; }
        
        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
                gap: 0.5rem;
                border-bottom: none;
            }
            
            .nav-tab {
                width: 100%;
                border-radius: 12px;
                padding: 1rem;
                border-bottom: 2px solid rgba(255, 255, 255, 0.1);
                text-align: left;
                margin-bottom: 0.25rem;
                bottom: 0;
            }
            
            .nav-tab.active {
                border-radius: 12px 12px 0 0;
                border-bottom: 3px solid var(--accent-color);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }
            
            .nav-tab::before {
                font-size: 1.3em;
                margin-right: 0.75rem;
            }
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* View Modes */
        .view-mode-selector {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }
        
        .view-mode-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .view-mode-buttons .btn {
            flex: 1;
            min-width: 150px;
        }
        
        /* Booking Status Badges */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .status-booked {
            background: #d4edda;
            color: #155724;
        }
        
        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
            text-decoration: line-through;
        }
        
        .status-past {
            background: #e9ecef;
            color: #495057;
            border: 1px solid #dee2e6;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        /* Cancelled booking styling */
        .booking-cancelled {
            opacity: 0.7;
            background: #f8f9fa !important;
            border-left-color: #95a5a6 !important;
        }
        
        .booking-cancelled .booking-title {
            text-decoration: line-through;
            color: #666;
        }
        
        /* Past booking styling */
        .booking-past {
            opacity: 0.8;
            background: #f8f9fa !important;
        }
        
        /* All Day Booking Checkbox */
        .all-day-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 1rem;
            padding: 1rem;
            background: #f0f9ff;
            border-radius: 8px;
            border: 1px solid #d1e9ff;
        }
        
        .all-day-container input[type="checkbox"] {
            transform: scale(1.3);
        }
        
        .all-day-label {
            font-weight: 600;
            color: var(--primary-blue);
            cursor: pointer;
        }
        
        .all-day-times {
            margin-left: auto;
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Calendar Styles */
        .calendar-select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.95rem;
            background: white;
            min-width: 120px;
        }
        
        .calendar-select:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .calendar-day {
            padding: 0.75rem;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: white;
            min-height: 120px;
        }
        
        .calendar-day-header {
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid #dee2e6;
        }
        
        .calendar-event {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            border-left: 3px solid;
        }
        
        .calendar-event-clubhouse {
            background: #e3f2fd;
            border-left-color: #3498db;
        }
        
        .calendar-event-gazebo {
            background: #e8f5e9;
            border-left-color: #27ae60;
        }
        
        .calendar-event-recroom {
            background: #f3e5f5;
            border-left-color: #9b59b6;
        }
        
        .calendar-event-cancelled {
            background: #f8d7da;
            border-left-color: #e74c3c;
            opacity: 0.7;
            text-decoration: line-through;
        }
        
        .calendar-event-time {
            font-weight: 600;
            color: #555;
            margin-right: 0.5rem;
        }
        
        .calendar-event-facility {
            font-weight: 600;
            margin-right: 0.5rem;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            body {
                padding: 10px;
            }
            
            .view-mode-buttons {
                flex-direction: column;
            }
            
            .view-mode-buttons .btn {
                width: 100%;
            }
            
            .calendar-grid {
                grid-template-columns: 1fr;
            }
            
            .calendar-select {
                min-width: 100px;
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header matching PasswordSettings.html -->
        <div class="booking-header">
            <div class="header-content">
                <img src="logo.png" alt="Lake Illawong Logo" class="logo-image">
                <div class="title-container">
                    <h1>Book Facilities</h1>
                    <p>Reserve Clubhouse, Gazebo, or Rec Room for your events</p>
                </div>
            </div>
            <div class="header-divider"></div>
        </div>
        
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('booking')">Make Booking</button>
            <button class="nav-tab" onclick="showTab('view')">View Bookings</button>
            <button class="nav-tab" onclick="showTab('calendar')">View Calendar</button>
            <button class="nav-tab" onclick="showTab('guidelines')">Guidelines</button>
            <button class="nav-tab" onclick="showTab('admin')" id="adminTabButton" style="display: none;">Admin</button>
        </div>
        
        <!-- Messages -->
        <div id="message" class="message"></div>
        
        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Processing your request...</p>
        </div>
        
        <!-- Booking Tab -->
        <div id="bookingTab" class="tab-content active">
            <!-- Quick Availability Check -->
            <div class="card" style="margin-bottom: 1.5rem; background: #f0f9ff;">
                <h2 style="color: #1e40af;">üìÖ Quick Availability Check</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    <div class="form-group">
                        <label for="quickDate">Date</label>
                        <input type="date" id="quickDate" style="width: 100%;">
                    </div>
                    
                    <div class="form-group">
                        <label for="quickStartTime">Start Time</label>
                        <select id="quickStartTime" style="width: 100%;">
                            <option value="08:00">8:00 AM</option>
                            <option value="09:00">9:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="12:00">12:00 PM</option>
                            <option value="13:00">1:00 PM</option>
                            <option value="14:00" selected>2:00 PM</option>
                            <option value="15:00">3:00 PM</option>
                            <option value="16:00">4:00 PM</option>
                            <option value="17:00">5:00 PM</option>
                            <option value="18:00">6:00 PM</option>
                            <option value="19:00">7:00 PM</option>
                            <option value="20:00">8:00 PM</option>
                            <option value="21:00">9:00 PM</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="quickEndTime">End Time</label>
                        <select id="quickEndTime" style="width: 100%;">
                            <option value="09:00">9:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="12:00">12:00 PM</option>
                            <option value="13:00">1:00 PM</option>
                            <option value="14:00">2:00 PM</option>
                            <option value="15:00">3:00 PM</option>
                            <option value="16:00" selected>4:00 PM</option>
                            <option value="17:00">5:00 PM</option>
                            <option value="18:00">6:00 PM</option>
                            <option value="19:00">7:00 PM</option>
                            <option value="20:00">8:00 PM</option>
                            <option value="21:00">9:00 PM</option>
                            <option value="22:00">10:00 PM</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-primary" onclick="quickCheckAvailability()" style="flex: 1;">
                        üîç Check Availability
                    </button>
                    <button class="btn btn-secondary" onclick="autoFillFromQuickCheck()" style="flex: 1;">
                        ‚úÖ Use These Times
                    </button>
                </div>
                
                <div id="quickAvailabilityResult" style="margin-top: 1rem; display: none;"></div>
            </div>

            <!-- Main Booking Form -->
            <div class="card">
                <h2>Make a Booking</h2>

                <!-- Facility Selection -->
                <div class="form-group required">
                    <label for="facility">Select Facility</label>
                    <div class="time-slots" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
                        <!-- Clubhouse -->
                        <label class="time-slot">
                            <input type="radio" name="facility" value="clubhouse" checked required>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.5em;">üè†</div>
                                    <div>
                                        <div style="font-weight: bold; font-size: 1.1em;">Clubhouse</div>
                                        <div style="font-size: 0.9em; color: #666;">Main building</div>
                                    </div>
                                </div>
                                <div style="font-size: 0.85em; color: #555; padding-left: 2.25rem;">
                                    ‚Ä¢ Kitchen facilities<br>
                                    ‚Ä¢ Seats up to 50<br>
                                    ‚Ä¢ Air conditioned<br>
                                    ‚Ä¢ TV & sound system
                                </div>
                            </div>
                        </label>
                        
                        <!-- Gazebo -->
                        <label class="time-slot">
                            <input type="radio" name="facility" value="gazebo" required>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.5em;">üå≥</div>
                                    <div>
                                        <div style="font-weight: bold; font-size: 1.1em;">Gazebo</div>
                                        <div style="font-size: 0.9em; color: #666;">Outdoor area</div>
                                    </div>
                                </div>
                                <div style="font-size: 0.85em; color: #555; padding-left: 2.25rem;">
                                    ‚Ä¢ Covered outdoor space<br>
                                    ‚Ä¢ BBQ facilities<br>
                                    ‚Ä¢ Picnic tables<br>
                                    ‚Ä¢ Garden lighting
                                </div>
                            </div>
                        </label>
                        
                        <!-- Rec Room -->
                        <label class="time-slot">
                            <input type="radio" name="facility" value="recroom" required>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.5em;">üéÆ</div>
                                    <div>
                                        <div style="font-weight: bold; font-size: 1.1em;">Rec Room</div>
                                        <div style="font-size: 0.9em; color: #666;">Games & lounge</div>
                                    </div>
                                </div>
                                <div style="font-size: 0.85em; color: #555; padding-left: 2.25rem;">
                                    ‚Ä¢ Pool table<br>
                                    ‚Ä¢ TV lounge<br>
                                    ‚Ä¢ Board games<br>
                                    ‚Ä¢ Small kitchenette
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
                
                <form id="bookingForm">
                    <div class="form-grid">
                        <!-- Left Column -->
                        <div>
                            <!-- Event Name -->
                            <div class="form-group required">
                                <label for="eventName">Event Name</label>
                                <input type="text" id="eventName" name="eventName" 
                                       placeholder="e.g., Birthday Party, Family Gathering" required>
                            </div>
                            
                            <!-- Unit Number -->
                            <div class="form-group required">
                                <label for="unitNumber">Unit Number</label>
                                <input type="text" id="unitNumber" name="unitNumber" required>
                            </div>
                            
                            <!-- Requester Phone -->
                            <div class="form-group">
                                <label for="phone">Requester Phone</label>
                                <input type="tel" id="phone" name="phone">
                            </div>
                        </div>
                        
                        <!-- Right Column -->
                        <div>
                            <!-- Event Date -->
                            <div class="form-group required">
                                <label for="eventDate">Event Date</label>
                                <input type="date" id="eventDate" name="eventDate" required>
                            </div>
                            
                            <!-- Requester Name -->
                            <div class="form-group required">
                                <label for="yourName">Requester Name</label>
                                <input type="text" id="yourName" name="yourName" required>
                            </div>
                            
                            <!-- Requester Email -->
                            <div class="form-group required">
                                <label for="email">Requester Email</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                        </div>
                    </div>
                    
                    <!-- All Day Booking Option -->
                    <div class="all-day-container">
                        <input type="checkbox" id="allDayBooking" name="allDayBooking" onchange="toggleAllDayBooking()">
                        <label for="allDayBooking" class="all-day-label">All Day Booking (8:00 AM - 10:00 PM)</label>
                        <div class="all-day-times">14 hours total</div>
                    </div>
                    
                    <!-- Time Slot Selection -->
                    <div class="form-group required">
                        <label>Time Slot</label>
                        <div class="time-slots">
                            <label class="time-slot">
                                <input type="radio" name="timeSlot" value="09:00-11:00" required>
                                <span>üïò Morning (9:00 AM - 11:00 AM)</span>
                            </label>
                            <label class="time-slot">
                                <input type="radio" name="timeSlot" value="14:00-16:00">
                                <span>üïë Afternoon (2:00 PM - 4:00 PM)</span>
                            </label>
                            <label class="time-slot">
                                <input type="radio" name="timeSlot" value="17:00-19:00">
                                <span>üïî Evening (5:00 PM - 7:00 PM)</span>
                            </label>
                            <label class="time-slot">
                                <input type="radio" name="timeSlot" value="custom">
                                <span>‚è∞ Custom Time</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Custom Time Fields -->
                    <div id="customTimeFields" style="display: none;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="startTime">Start Time</label>
                                <input type="time" id="startTime" name="startTime" min="06:00" max="22:00">
                            </div>
                            <div class="form-group">
                                <label for="endTime">End Time</label>
                                <input type="time" id="endTime" name="endTime" min="06:00" max="22:00">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Event Type -->
                    <div class="form-group required">
                        <label for="eventType">Event Type</label>
                        <select id="eventType" name="eventType" required>
                            <option value="">Select event type</option>
                            <option value="birthday">üéÇ Birthday Party</option>
                            <option value="family">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Gathering</option>
                            <option value="committee">üìã Committee Meeting</option>
                            <option value="social">üíÉ Social Event</option>
                            <option value="other">üìÖ Other</option>
                        </select>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary" onclick="checkAvailability()">
                            üîç Check Availability
                        </button>
                        <button type="submit" class="btn btn-primary btn-large">
                            üìÖ Confirm Booking
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- View Bookings Tab -->
        <div id="viewTab" class="tab-content">
            <div class="card">
                <h2>View Bookings</h2>
                
                <!-- View Mode Selector -->
                <div class="view-mode-selector">
                    <h3 style="margin-bottom: 1rem; color: var(--primary-blue);">Select View Mode:</h3>
                    
                    <!-- Public View (Default) -->
                    <div id="publicViewInfo" style="display: block;">
                        <p style="margin-bottom: 1rem;"><strong>Public View:</strong> Shows all bookings with limited details (facility, date, time only).</p>
                        <div class="view-mode-buttons">
                            <button class="btn btn-secondary" onclick="showPersonalView()">
                                üîê Show My Bookings
                            </button>
                            <button class="btn btn-warning" onclick="toggleAdminLogin()">
                                üõ†Ô∏è Admin Access
                            </button>
                        </div>
                    </div>
                    
                    <!-- Personal View -->
                    <div id="personalViewForm" style="display: none;">
                        <p style="margin-bottom: 1rem;"><strong>Personal View:</strong> Enter your email to view and manage your bookings.</p>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <input type="email" id="personalEmail" placeholder="Enter your email address" style="flex: 1;">
                            <button class="btn btn-primary" onclick="loadPersonalBookings()">
                                Load My Bookings
                            </button>
                            <button class="btn btn-secondary" onclick="showPublicView()">
                                Back to Public View
                            </button>
                        </div>
                        <div id="personalEmailStatus" style="margin-top: 0.5rem; font-size: 0.9rem;"></div>
                    </div>
                    
                    <!-- Admin Login -->
                    <div id="adminLoginForm" style="display: none;">
                        <p style="margin-bottom: 1rem;"><strong>Admin Access:</strong> Enter admin password to view all bookings.</p>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <input type="password" id="adminPassword" placeholder="Enter admin password" style="flex: 1;">
                            <button class="btn btn-warning" onclick="loginAsAdmin()">
                                Login as Admin
                            </button>
                            <button class="btn btn-secondary" onclick="showPublicView()">
                                Back to Public View
                            </button>
                        </div>
                        <div id="adminLoginStatus" style="margin-top: 0.5rem; font-size: 0.9rem;"></div>
                    </div>
                    
                    <!-- Admin View Active -->
                    <div id="adminViewActive" style="display: none;">
                        <p style="margin-bottom: 1rem;"><strong>Admin View Active:</strong> You can view and manage all bookings.</p>
                        <div class="view-mode-buttons">
                            <button class="btn btn-warning" onclick="loadAllBookings()">
                                üîÑ Refresh All Bookings
                            </button>
                            <button class="btn btn-secondary" onclick="logoutAdmin()">
                                Logout Admin Access
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Bookings Display -->
                <div id="bookingsList">
                    <!-- Bookings will be loaded here -->
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="loadBookings()">
                        üîÑ Refresh List
                    </button>
                </div>
            </div>
        </div>
        
        <!-- View Calendar Tab -->
        <div id="calendarTab" class="tab-content">
            <div class="card">
                <h2>üìÖ Facilities Calendar</h2>
                
                <!-- Calendar Controls -->
                <div style="margin-bottom: 1.5rem;">
                    <div style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="loadCalendarView()" style="min-width: 140px;">
                            <span style="font-size: 1.1em;">üîÑ</span> Load Calendar
                        </button>
                        
                        <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
                            <select id="calendarMonth" class="calendar-select" onchange="loadCalendarView()">
                                <option value="0">January</option>
                                <option value="1">February</option>
                                <option value="2">March</option>
                                <option value="3">April</option>
                                <option value="4">May</option>
                                <option value="5">June</option>
                                <option value="6">July</option>
                                <option value="7">August</option>
                                <option value="8">September</option>
                                <option value="9">October</option>
                                <option value="10">November</option>
                                <option value="11">December</option>
                            </select>
                            
                            <select id="calendarYear" class="calendar-select" onchange="loadCalendarView()">
                                <option value="2024">2024</option>
                                <option value="2025" selected>2025</option>
                                <option value="2026">2026</option>
                            </select>
                            
                            <select id="calendarFacility" class="calendar-select" onchange="loadCalendarView()">
                                <option value="all">All Facilities</option>
                                <option value="clubhouse">üè† Clubhouse</option>
                                <option value="gazebo">üå≥ Gazebo</option>
                                <option value="recroom">üéÆ Rec Room</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-secondary" onclick="goToToday()" style="margin-left: auto;">
                            <span style="font-size: 1.1em;">üìÖ</span> Today
                        </button>
                    </div>
                    
                    <!-- Legend -->
                    <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap; padding: 0.75rem; background: #f8f9fa; border-radius: 6px;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 12px; height: 12px; background: #3498db; border-radius: 2px;"></div>
                            <span style="font-size: 0.9em; font-weight: 600;">üè† Clubhouse</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 12px; height: 12px; background: #27ae60; border-radius: 2px;"></div>
                            <span style="font-size: 0.9em; font-weight: 600;">üå≥ Gazebo</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 12px; height: 12px; background: #9b59b6; border-radius: 2px;"></div>
                            <span style="font-size: 0.9em; font-weight: 600;">üéÆ Rec Room</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-left: auto;">
                            <div style="width: 12px; height: 12px; background: #f8d7da; border-radius: 2px; border: 1px solid #721c24;"></div>
                            <span style="font-size: 0.9em; font-weight: 600;">Cancelled</span>
                        </div>
                    </div>
                </div>
                
                <!-- Calendar Display -->
                <div id="simpleCalendar" style="min-height: 400px; padding: 1.5rem; background: white; border-radius: 8px; border: 1px solid #dee2e6;">
                    <div style="text-align: center; color: #666; padding: 3rem;">
                        <div style="font-size: 3em; margin-bottom: 1rem;">üìÖ</div>
                        <h3 style="margin-bottom: 0.5rem; color: var(--primary-blue);">Facilities Calendar</h3>
                        <p style="margin-bottom: 1.5rem;">View all bookings across Clubhouse, Gazebo, and Rec Room</p>
                        <button class="btn btn-primary btn-large" onclick="loadCalendarView()">
                            <span style="font-size: 1.2em;">üîÑ</span> Load Calendar
                        </button>
                        <p style="margin-top: 1rem; font-size: 0.9em; color: #888;">
                            Shows upcoming and recent bookings
                        </p>
                    </div>
                </div>
                
                <!-- Info Panel -->
                <div style="margin-top: 1.5rem; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">
                    <h3 style="margin-bottom: 1rem; color: var(--primary-blue);">üí° Using the Calendar</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.5rem; color: #555; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.2em;">üîç</span> Check Availability
                            </div>
                            <div style="font-size: 0.9em; color: #666; line-height: 1.5;">
                                1. Select month and facility<br>
                                2. See booked times in color<br>
                                3. Use "Make Booking" tab to book<br>
                                4. Cancel if plans change
                            </div>
                        </div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.5rem; color: #555; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.2em;">üè†</span> Facility Colors
                            </div>
                            <div style="font-size: 0.9em; color: #666; line-height: 1.5;">
                                ‚Ä¢ <span style="color: #3498db;">Blue</span>: Clubhouse<br>
                                ‚Ä¢ <span style="color: #27ae60;">Green</span>: Gazebo<br>
                                ‚Ä¢ <span style="color: #9b59b6;">Purple</span>: Rec Room<br>
                                ‚Ä¢ <span style="color: #e74c3c;">Red</span>: Cancelled
                            </div>
                        </div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.5rem; color: #555; display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1.2em;">üì±</span> Mobile Friendly
                            </div>
                            <div style="font-size: 0.9em; color: #666; line-height: 1.5;">
                                ‚Ä¢ Works on all devices<br>
                                ‚Ä¢ Quick loading<br>
                                ‚Ä¢ No external dependencies<br>
                                ‚Ä¢ Secure and private
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Guidelines Tab -->
        <div id="guidelinesTab" class="tab-content">
            <div class="card">
                <h2>üè† Clubhouse Guidelines & Rules</h2>
                
                <div style="display: grid; gap: 1.5rem;">
                    <!-- Booking Rules -->
                    <div style="background: #f0f9ff; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #3498db;">
                        <h3 style="color: #1e40af; margin-bottom: 1rem;">üìÖ Booking Rules</h3>
                        <ul style="padding-left: 1.5rem;">
                            <li>Bookings can be made up to 90 days in advance</li>
                            <li>Maximum booking duration: 8 hours per day</li>
                            <li>Operating hours: 6:00 AM to 10:00 PM</li>
                            <li>Bookings must be made by residents only</li>
                            <li>Please cancel if you cannot attend</li>
                        </ul>
                    </div>
                    
                    <!-- Usage Guidelines -->
                    <div style="background: #f0fff4; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #27ae60;">
                        <h3 style="color: #166534; margin-bottom: 1rem;">‚úÖ Usage Guidelines</h3>
                        <ul style="padding-left: 1.5rem;">
                            <li>Leave the clubhouse clean and tidy</li>
                            <li>Return furniture to original positions</li>
                            <li>Dispose of all rubbish properly</li>
                            <li>Turn off all lights and appliances after use</li>
                            <li>Report any damage to management immediately</li>
                        </ul>
                    </div>
                    
                    <!-- Noise & Conduct -->
                    <div style="background: #fff7ed; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #f39c12;">
                        <h3 style="color: #92400e; margin-bottom: 1rem;">üîä Noise & Conduct</h3>
                        <ul style="padding-left: 1.5rem;">
                            <li>Respect quiet hours: 8:00 PM to 8:00 AM</li>
                            <li>Keep noise at reasonable levels</li>
                            <li>Be considerate of nearby residents</li>
                            <li>No amplified music after 8:00 PM</li>
                            <li>Maximum capacity: 30 people</li>
                        </ul>
                    </div>
                    
                    <!-- Important Reminders -->
                    <div style="background: #fef2f2; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #e74c3c;">
                        <h3 style="color: #991b1b; margin-bottom: 1rem;">‚ö†Ô∏è Important Reminders</h3>
                        <ul style="padding-left: 1.5rem;">
                            <li>You are responsible for your guests</li>
                            <li>No smoking inside the clubhouse</li>
                            <li>Alcohol consumption must be responsible</li>
                            <li>Fire exits must remain clear at all times</li>
                            <li>Emergency contact: [Your Contact Number]</li>
                        </ul>
                    </div>
                    
                    <!-- Contact Information -->
                    <div style="background: #faf5ff; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #8b5cf6;">
                        <h3 style="color: #5b21b6; margin-bottom: 1rem;">üìû Contact & Support</h3>
                        <div style="display: grid; gap: 0.75rem;">
                            <div>
                                <strong>Booking Issues:</strong>
                                <div>Email: management@lakeillawong.example.com</div>
                            </div>
                            <div>
                                <strong>Emergencies:</strong>
                                <div>Phone: 000 (Emergency Services)</div>
                            </div>
                            <div>
                                <strong>Maintenance:</strong>
                                <div>Contact building management</div>
                            </div>
                            <div>
                                <strong>Lost Property:</strong>
                                <div>Check with security or management</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Simple footer note -->
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #dee2e6; text-align: center; color: #666;">
                    <p>These guidelines help ensure the clubhouse remains a pleasant space for all residents.</p>
                    <p>Thank you for your cooperation! üôè</p>
                </div>
            </div>
        </div>
        
        <!-- Admin Tab -->
        <div id="adminTab" class="tab-content">
            <div class="card">
                <h2>üõ†Ô∏è Admin Panel</h2>
                
                <!-- Admin Login Section (shown by default) -->
                <div id="adminLoginSection">
                    <div style="background: #fff3cd; padding: 2rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #ffc107;">
                        <h3 style="color: #856404; margin-bottom: 1rem;">Admin Access Required</h3>
                        <p style="margin-bottom: 1.5rem;">This panel is for administrators only. Please enter the admin password to continue.</p>
                        
                        <div style="max-width: 400px;">
                            <div class="form-group">
                                <label for="adminTabPassword">Admin Password</label>
                                <input type="password" id="adminTabPassword" placeholder="Enter admin password" 
                                       style="width: 100%; padding: 0.75rem; font-size: 1.1rem;">
                            </div>
                            
                            <div class="btn-group" style="margin-top: 1.5rem;">
                                <button class="btn btn-warning" onclick="adminLogin()" style="flex: 1;">
                                    üîê Login as Admin
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Dashboard (hidden until login) -->
                <div id="adminDashboard" style="display: none;">
                    <!-- Status Bar -->
                    <div id="adminStatusBar" style="background: #d4edda; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #28a745;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>üõ†Ô∏è Admin Mode Active</strong>
                                <div style="font-size: 0.9em; margin-top: 0.25rem;">Logged in as: <span id="adminUserName">Administrator</span></div>
                            </div>
                            <button class="btn btn-secondary btn-small" onclick="adminLogout()">
                                üö™ Logout
                            </button>
                        </div>
                    </div>
                    
                    <!-- Centralized Password Management Section -->
                    <div class="admin-section" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid #dee2e6;">
                        <h3 style="color: var(--primary-blue); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                            üîê Password Management
                        </h3>
                        <p style="color: #666; margin-bottom: 1.5rem; font-size: 0.95rem;">
                            <strong>Centralized Password System</strong><br>
                            Admin passwords are managed by the central Password Manager.
                        </p>
                        
                        <div style="background: #f0f9ff; padding: 1rem; border-radius: 6px; margin: 1rem 0; border-left: 4px solid #3498db;">
                            <p style="margin-bottom: 0.75rem; font-weight: 600;">To change admin password:</p>
                            <ol style="margin-left: 1.5rem; margin-bottom: 1rem;">
                                <li>Open <strong>PasswordSettings.html</strong></li>
                                <li>Select "booking" portal</li>
                                <li>Enter current password</li>
                                <li>Set new password</li>
                            </ol>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="window.open('PasswordSettings.html', '_blank')">
                                üìã Open Password Settings
                            </button>
                            <button class="btn btn-secondary" onclick="loadBookingPasswordFromManager()">
                                üîÑ Refresh Password
                            </button>
                        </div>
                        
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee; font-size: 0.85rem; color: #666;">
                            <strong>üí° Note:</strong> All password changes must be made through the centralized Password Manager.
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--primary-blue);">‚ö° Quick Actions</h3>
                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="showCreateEventModal()">
                                ‚ûï Add Event
                            </button>
                            <button class="btn btn-warning" onclick="showBlockTimeModal()">
                                ‚õî Block Time
                            </button>
                            <button class="btn btn-secondary" onclick="loadAllEvents()">
                                üîÑ Refresh Events
                            </button>
                            <button class="btn btn-success" onclick="showReports()">
                                üìä View Reports
                            </button>
                        </div>
                    </div>
                    
                    <!-- Calendar Status Dashboard -->
                    <div style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--primary-blue);">üìÖ Calendar Status</h3>
                        <div id="calendarStatus" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                            <div style="text-align: center; padding: 2rem; color: #666;">
                                <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 1rem;"></div>
                                Loading calendar status...
                            </div>
                        </div>
                    </div>
                    
                    <!-- Upcoming Events -->
                    <div style="margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="color: var(--primary-blue); margin: 0;">üìã Upcoming Events (Next 30 Days)</h3>
                            <div style="display: flex; gap: 0.5rem;">
                                <select id="adminFacilityFilter" class="calendar-select" onchange="loadAllEvents()" style="min-width: 150px;">
                                    <option value="all">All Facilities</option>
                                    <option value="clubhouse">üè† Clubhouse</option>
                                    <option value="gazebo">üå≥ Gazebo</option>
                                    <option value="recroom">üéÆ Rec Room</option>
                                </select>
                                <select id="adminViewType" class="calendar-select" onchange="loadAllEvents()" style="min-width: 120px;">
                                    <option value="list">List View</option>
                                    <option value="calendar">Calendar View</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="adminEventsList">
                            <div style="text-align: center; padding: 2rem; color: #666;">
                                <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 1rem;"></div>
                                Loading events...
                            </div>
                        </div>
                    </div>
                    
                    <!-- Statistics -->
                    <div>
                        <h3 style="margin-bottom: 1rem; color: var(--primary-blue);">üìä Quick Statistics</h3>
                        <div id="adminStatistics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div style="background: #e8f4fd; padding: 1.5rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; margin-bottom: 0.5rem;">üìÖ</div>
                                <div style="font-size: 1.5em; font-weight: bold; margin-bottom: 0.25rem;">--</div>
                                <div style="font-size: 0.9em; color: #666;">Total Events</div>
                            </div>
                            <div style="background: #e8f4fd; padding: 1.5rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; margin-bottom: 0.5rem;">üè†</div>
                                <div style="font-size: 1.5em; font-weight: bold; margin-bottom: 0.25rem;">--</div>
                                <div style="font-size: 0.9em; color: #666;">Clubhouse</div>
                            </div>
                            <div style="background: #e8f4fd; padding: 1.5rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; margin-bottom: 0.5rem;">üå≥</div>
                                <div style="font-size: 1.5em; font-weight: bold; margin-bottom: 0.25rem;">--</div>
                                <div style="font-size: 0.9em; color: #666;">Gazebo</div>
                            </div>
                            <div style="background: #e8f4fd; padding: 1.5rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; margin-bottom: 0.5rem;">üéÆ</div>
                                <div style="font-size: 1.5em; font-weight: bold; margin-bottom: 0.25rem;">--</div>
                                <div style="font-size: 0.9em; color: #666;">Rec Room</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Create Event Modal -->
<div id="createEventModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; width: 90%; max-width: 500px; border-radius: 12px; padding: 2rem; max-height: 90vh; overflow-y: auto;">
        <h3 style="margin-bottom: 1.5rem; color: var(--primary-blue);">‚ûï Create Event</h3>
        
        <div class="form-group">
            <label for="adminEventFacility">Select Facility</label>
            <select id="adminEventFacility" class="calendar-select" style="width: 100%;">
                <option value="clubhouse">üè† Clubhouse</option>
                <option value="gazebo">üå≥ Gazebo</option>
                <option value="recroom">üéÆ Rec Room</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="adminEventTitle">Event Title</label>
            <input type="text" id="adminEventTitle" placeholder="e.g., Committee Meeting, Maintenance" style="width: 100%;">
        </div>
        
        <div class="form-grid">
            <div class="form-group">
                <label for="adminEventDate">Date</label>
                <input type="date" id="adminEventDate" style="width: 100%;">
            </div>
            <div class="form-group">
                <label for="adminEventStartTime">Start Time</label>
                <input type="time" id="adminEventStartTime" style="width: 100%;">
            </div>
            <div class="form-group">
                <label for="adminEventEndTime">End Time</label>
                                <input type="time" id="adminEventEndTime" style="width: 100%;">
            </div>
        </div>
        
        <div class="form-group">
            <label for="adminEventDescription">Description (Optional)</label>
            <textarea id="adminEventDescription" placeholder="Event details, notes, etc." rows="3" style="width: 100%;"></textarea>
        </div>
        
        <div class="btn-group" style="margin-top: 2rem;">
            <button class="btn btn-secondary" onclick="hideCreateEventModal()" style="flex: 1;">
                Cancel
            </button>
            <button class="btn btn-primary" onclick="createAdminEvent()" style="flex: 1;">
                Create Event
            </button>
        </div>
    </div>
</div>

    <script>
    // ========== CONFIGURATION ==========
    var BACKEND_URL = 'https://script.google.com/macros/s/AKfycbwHwXWJdSpRP6j3CJVDWSZ_n6vEBjEhpA9wZv1AunaGsCfKPBaIGnzrexJe_8asf6PF/exec';
    
    // **IMPORTANT**: Default password - will be updated from Password Manager
    var ADMIN_PASSWORD = 'admin2024'; 
    
    // Password Manager API - THIS IS THE CENTRAL PASSWORD SYSTEM
    var PASSWORD_API = 'https://script.google.com/macros/s/AKfycbyu0RdVfmlQEnr1wi5tfkPi-tGNLzKcs5H3R9DAnKXzZROwqEPhnCvpNq3CsjKGeaxXwA/exec';
    
    // ========== GLOBAL STATE ==========
    var currentTab = 'booking';
    var currentViewMode = 'public'; // 'public', 'personal', 'admin'
    var userEmail = '';
    var isAdmin = false;
    var adminLoggedIn = false;
    
    // ========== INITIALIZATION ==========
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üîê Booking System v1.0 - Using Centralized Password Manager');
        
        // Set date restrictions for main form
        var today = new Date();
        var dateInput = document.getElementById('eventDate');
        dateInput.min = today.toISOString().split('T')[0];
        
        var maxDate = new Date();
        maxDate.setDate(today.getDate() + 90);
        dateInput.max = maxDate.toISOString().split('T')[0];
        
        // Default main form to tomorrow
        var tomorrow = new Date();
        tomorrow.setDate(today.getDate() + 1);
        dateInput.value = tomorrow.toISOString().split('T')[0];
        
        // Set quick check date to tomorrow too
        var quickDateInput = document.getElementById('quickDate');
        if (quickDateInput) {
            quickDateInput.min = today.toISOString().split('T')[0];
            quickDateInput.max = maxDate.toISOString().split('T')[0];
            quickDateInput.value = tomorrow.toISOString().split('T')[0];
        }
        
        // Set calendar to current month
        var currentMonth = today.getMonth();
        document.getElementById('calendarMonth').value = currentMonth;
        
        // Handle custom time selection
        document.querySelectorAll('input[name="timeSlot"]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                var customFields = document.getElementById('customTimeFields');
                if (this.value === 'custom') {
                    customFields.style.display = 'block';
                } else {
                    customFields.style.display = 'none';
                }
                
                // Update styling
                document.querySelectorAll('.time-slot').forEach(function(slot) {
                    slot.classList.remove('selected');
                });
                this.closest('.time-slot').classList.add('selected');
            });
        });
        
        // Form submission
        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            submitBooking();
        });
        
        // Load initial bookings (public view)
        loadBookings();
        
        // Try to load saved email from localStorage
        var savedEmail = localStorage.getItem('lakeIllawongBookingEmail');
        if (savedEmail) {
            document.getElementById('personalEmail').value = savedEmail;
        }
        
        // Update admin tab visibility
        updateAdminTabVisibility();
        
        // LOAD PASSWORD FROM CENTRAL PASSWORD MANAGER ON STARTUP
        loadBookingPasswordFromManager();
    });
    
    // ========== CENTRALIZED PASSWORD MANAGER INTEGRATION ==========
    // **ONLY LOADS PASSWORD - NO PASSWORD MANAGEMENT HERE**
    
    // Load current booking system password from Password Manager
    function loadBookingPasswordFromManager() {
    console.log('üì° Loading booking system password from Central Password Manager...');
    
    const callbackName = `load_pass_callback_${Date.now()}`;
    
    window[callbackName] = function(data) {
        if (data.success && data.passwords && data.passwords.booking) {
            ADMIN_PASSWORD = data.passwords.booking;
            console.log('‚úÖ Booking password loaded from Password Manager:', ADMIN_PASSWORD);
            showMessage('‚úÖ Admin password loaded from Central Password Manager', 'success');
        } else {
            console.warn('‚ö†Ô∏è Using default booking password');
        }
        delete window[callbackName];
    };
    
    // ADD CACHE BUSTING - timestamp and random parameter
    const timestamp = Date.now();
    const random = Math.random().toString(36).substring(7);
    const scriptUrl = `${PASSWORD_API}?action=getPasswords&callback=${callbackName}&_t=${timestamp}&r=${random}`;
    
    const script = document.createElement('script');
    script.src = scriptUrl;
    
    script.onerror = function() {
        console.warn('‚ö†Ô∏è Password API unavailable, using default password');
        delete window[callbackName];
    };
    
    // Set timeout to prevent hanging callbacks
    setTimeout(() => {
        if (window[callbackName]) {
            console.warn('‚è∞ Timeout waiting for Password Manager response');
            delete window[callbackName];
        }
    }, 5000);
    
    document.head.appendChild(script);
}
    
    // ========== ADMIN FUNCTIONS ==========
    function adminLogin() {
        var password = document.getElementById('adminTabPassword').value;
        
        // **CHECK AGAINST PASSWORD FROM CENTRAL MANAGER**
        if (password === ADMIN_PASSWORD) {
            // Admin login successful
            adminLoggedIn = true;
            currentViewMode = 'admin';
            isAdmin = true;
            
            // Show admin dashboard
            document.getElementById('adminLoginSection').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            
            // Update UI
            updateAdminTabVisibility();
            
            // Load admin data
            loadCalendarStatus();
            loadAllEvents();
            
            // Show success message
            showMessage('‚úÖ Admin access granted', 'success');
            
            // Clear password field for security
            document.getElementById('adminTabPassword').value = '';
            
        } else {
            showMessage('‚ùå Invalid password', 'error');
        }
    }
    
    function adminLogout() {
        adminLoggedIn = false;
        currentViewMode = 'public';
        isAdmin = false;
        
        // Show login section
        document.getElementById('adminLoginSection').style.display = 'block';
        document.getElementById('adminDashboard').style.display = 'none';
        document.getElementById('adminTabPassword').value = '';
        
        // Update UI
        updateAdminTabVisibility();
        showMessage('üëã Admin access ended', 'info');
        
        // If on admin tab, switch to booking tab
        if (currentTab === 'admin') {
            showTab('booking');
        }
    }
    
    // ========== TAB NAVIGATION ==========
    function showTab(tabName) {
        // ADMIN CHECK
        if (tabName === 'admin' && !adminLoggedIn) {
            showMessage('Please log in as admin to access admin panel', 'info');
            return;
        }
        
        // Update tabs
        document.querySelectorAll('.nav-tab').forEach(function(tab) {
            tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-content').forEach(function(content) {
            content.classList.remove('active');
        });
        
        // Activate selected tab
        var tabIndex = ['booking','view','calendar','guidelines','admin'].indexOf(tabName) + 1;
        var tabSelector = `.nav-tab:nth-child(${tabIndex})`;
        document.querySelector(tabSelector).classList.add('active');
        document.getElementById(tabName + 'Tab').classList.add('active');
        currentTab = tabName;
        
        // Load data if needed
        if (tabName === 'view') {
            loadBookings();
        } else if (tabName === 'calendar') {
            setTimeout(() => {
                if (document.getElementById('simpleCalendar').innerHTML.includes('üìÖ')) {
                    loadCalendarView();
                }
            }, 300);
        } else if (tabName === 'admin' && adminLoggedIn) {
            loadCalendarStatus();
            loadAllEvents();
        }
    }
    
    // ========== ADMIN TAB VISIBILITY ==========
    function updateAdminTabVisibility() {
        var adminTabButton = document.getElementById('adminTabButton');
        if (adminTabButton) {
            adminTabButton.style.display = adminLoggedIn ? 'flex' : 'none';
        }
    }
    
    // ========== ALL DAY BOOKING ==========
    function toggleAllDayBooking() {
        var allDayCheckbox = document.getElementById('allDayBooking');
        var customRadio = document.querySelector('input[name="timeSlot"][value="custom"]');
        var customFields = document.getElementById('customTimeFields');
        
        if (allDayCheckbox.checked) {
            // Set custom time slot and fill with 8am-10pm
            if (customRadio) {
                customRadio.checked = true;
                customRadio.dispatchEvent(new Event('change'));
                document.getElementById('startTime').value = '08:00';
                document.getElementById('endTime').value = '22:00';
                customFields.style.display = 'block';
            }
            
            // Disable other time slot options
            document.querySelectorAll('input[name="timeSlot"]:not([value="custom"])').forEach(function(radio) {
                radio.disabled = true;
                radio.closest('.time-slot').style.opacity = '0.5';
                radio.closest('.time-slot').style.cursor = 'not-allowed';
            });
        } else {
            // Re-enable time slot options
            document.querySelectorAll('input[name="timeSlot"]:not([value="custom"])').forEach(function(radio) {
                radio.disabled = false;
                radio.closest('.time-slot').style.opacity = '1';
                radio.closest('.time-slot').style.cursor = 'pointer';
            });
            
            // If custom was selected just for all-day, reset to first option
            if (customRadio && customRadio.checked) {
                var firstRadio = document.querySelector('input[name="timeSlot"]:not([value="custom"])');
                if (firstRadio) {
                    firstRadio.checked = true;
                    firstRadio.dispatchEvent(new Event('change'));
                }
            }
        }
    }
    
    // ========== VIEW MODE MANAGEMENT ==========
    function showPublicView() {
        currentViewMode = 'public';
        userEmail = '';
        isAdmin = false;
        adminLoggedIn = false;
        
        // Update UI
        document.getElementById('publicViewInfo').style.display = 'block';
        document.getElementById('personalViewForm').style.display = 'none';
        document.getElementById('adminLoginForm').style.display = 'none';
        document.getElementById('adminViewActive').style.display = 'none';
        
        // Clear fields
        document.getElementById('personalEmail').value = '';
        document.getElementById('adminPassword').value = '';
        
        // Update admin tab
        updateAdminTabVisibility();
        
        // Load public bookings
        loadBookings();
    }
    
    function showPersonalView() {
        // Show personal view form
        document.getElementById('publicViewInfo').style.display = 'none';
        document.getElementById('personalViewForm').style.display = 'block';
        document.getElementById('adminLoginForm').style.display = 'none';
        document.getElementById('adminViewActive').style.display = 'none';
        
        // Focus on email field
        document.getElementById('personalEmail').focus();
    }
    
    function toggleAdminLogin() {
        // Show admin login form
        document.getElementById('publicViewInfo').style.display = 'none';
        document.getElementById('personalViewForm').style.display = 'none';
        document.getElementById('adminLoginForm').style.display = 'block';
        document.getElementById('adminViewActive').style.display = 'none';
        
        // Focus on password field
        document.getElementById('adminPassword').focus();
    }
    
    function loadPersonalBookings() {
        var email = document.getElementById('personalEmail').value.trim();
        if (!email) {
            document.getElementById('personalEmailStatus').innerHTML = 
                '<span style="color: var(--danger-color);">Please enter your email address</span>';
            return;
        }
        
        // Validate email format
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            document.getElementById('personalEmailStatus').innerHTML = 
                '<span style="color: var(--danger-color);">Please enter a valid email address</span>';
            return;
        }
        
        // Save email to localStorage for convenience
        localStorage.setItem('lakeIllawongBookingEmail', email);
        
        // Set current view mode
        currentViewMode = 'personal';
        userEmail = email;
        isAdmin = false;
        adminLoggedIn = false;
        
        // Update UI
        document.getElementById('personalEmailStatus').innerHTML = 
            '<span style="color: var(--success-color);">Loading your bookings...</span>';
        
        // Update admin tab
        updateAdminTabVisibility();
        
        // Load personal bookings
        loadBookings();
    }
    
    function loginAsAdmin() {
        var password = document.getElementById('adminPassword').value;
        
        // **CHECK AGAINST PASSWORD FROM CENTRAL MANAGER**
        if (password === ADMIN_PASSWORD) {
            // Admin login successful - SET ALL ADMIN FLAGS
            currentViewMode = 'admin';
            userEmail = '';
            isAdmin = true;
            adminLoggedIn = true;
            
            // Update UI in View Bookings tab
            updateAdminTabVisibility();
            document.getElementById('adminLoginForm').style.display = 'none';
            document.getElementById('adminViewActive').style.display = 'block';
            document.getElementById('adminLoginStatus').innerHTML = 
                '<span style="color: var(--success-color);">Admin access granted</span>';
            
            // Clear password field for security
            document.getElementById('adminPassword').value = '';
            
            // Load all bookings in admin view
            loadBookings();
            
            // Show success message
            showMessage('‚úÖ Admin access granted. You can now access the Admin tab.', 'success');
            
        } else {
            document.getElementById('adminLoginStatus').innerHTML = 
                '<span style="color: var(--danger-color);">Incorrect password</span>';
        }
    }
    
    function logoutAdmin() {
        // Reset ALL admin states completely
        currentViewMode = 'public';
        userEmail = '';
        isAdmin = false;
        adminLoggedIn = false;
        
        // Update UI in View Bookings tab
        updateAdminTabVisibility();
        showPublicView();
        
        // ALSO logout from Admin tab if it's open
        if (document.getElementById('adminDashboard').style.display !== 'none') {
            document.getElementById('adminLoginSection').style.display = 'block';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('adminTabPassword').value = '';
        }
        
        // Show message
        showMessage('üëã Admin access ended', 'info');
    }
    
    function loadAllBookings() {
        loadBookings();
    }
    
    // ========== LOAD BOOKINGS ==========
    function loadBookings() {
        showLoading(true);
        
        callAPI('getBookings', {}, function(response) {
            showLoading(false);
            
            console.log('üìä Booking response:', response);
            
            var bookingsList = document.getElementById('bookingsList');
            if (!bookingsList) return;
            
            if (response.success && response.bookings && response.bookings.length > 0) {
                // Filter bookings based on view mode
                var filteredBookings = response.bookings;
                
                if (currentViewMode === 'personal' && userEmail) {
                    filteredBookings = response.bookings.filter(function(booking) {
                        return booking.residentEmail && 
                               booking.residentEmail.toLowerCase() === userEmail.toLowerCase();
                    });
                }
                
                // Sort by date (most recent first)
                filteredBookings.sort(function(a, b) {
                    return new Date(b.start) - new Date(a.start);
                });
                
                // Separate upcoming and past bookings
                var now = new Date();
                var upcomingBookings = [];
                var pastBookings = [];
                
                filteredBookings.forEach(function(booking) {
                    var bookingDate = new Date(booking.start);
                    if (bookingDate >= now) {
                        upcomingBookings.push(booking);
                    } else {
                        pastBookings.push(booking);
                    }
                });
                
                // Sort upcoming by date (soonest first)
                upcomingBookings.sort(function(a, b) {
                    return new Date(a.start) - new Date(b.start);
                });
                
                var html = '';
                
                // Show view mode info
                if (currentViewMode === 'public') {
                    html += '<div style="background: #e8f4fd; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #3498db;">';
                    html += '<p><strong>Public View:</strong> Showing facility availability only. No personal details are shown.</p>';
                    html += '<p style="margin-top: 0.5rem; font-size: 0.9em;">To view and manage your bookings, click "Show My Bookings" above.</p>';
                    html += '</div>';
                } else if (currentViewMode === 'personal') {
                    html += '<div style="background: #d4edda; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #28a745;">';
                    html += '<p><strong>Personal View:</strong> Showing your bookings only. Email: ' + userEmail + '</p>';
                    if (upcomingBookings.length === 0) {
                        html += '<p style="margin-top: 0.5rem; font-size: 0.9em;">You have no upcoming bookings.</p>';
                    }
                    html += '</div>';
                } else if (currentViewMode === 'admin') {
                    html += '<div style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #ffc107;">';
                    html += '<p><strong>Admin View:</strong> Showing all bookings. You can manage any booking.</p>';
                    html += '<p style="margin-top: 0.5rem; font-size: 0.9em;">Total bookings: ' + filteredBookings.length + '</p>';
                    html += '</div>';
                }
                
                // Show upcoming bookings
                if (upcomingBookings.length > 0) {
                    html += '<h3 style="margin-bottom: 1rem; color: var(--primary-blue);">Upcoming Bookings</h3>';
                    html += '<div style="display: grid; gap: 1rem; margin-bottom: 2rem;">';
                    
                    upcomingBookings.forEach(function(booking) {
                        html += renderBookingCard(booking);
                    });
                    
                    html += '</div>';
                }
                
                // Show past bookings (only in personal/admin views)
                if ((currentViewMode === 'personal' || currentViewMode === 'admin') && pastBookings.length > 0) {
                    html += '<h3 style="margin-bottom: 1rem; color: #666; border-top: 1px solid #dee2e6; padding-top: 1.5rem;">Past Bookings</h3>';
                    html += '<div style="display: grid; gap: 1rem; opacity: 0.8;">';
                    
                    pastBookings.forEach(function(booking) {
                        html += renderBookingCard(booking);
                    });
                    
                    html += '</div>';
                }
                
                if (filteredBookings.length === 0) {
                    if (currentViewMode === 'personal') {
                        html += '<div style="text-align: center; padding: 3rem; color: #666;">';
                        html += '<div style="font-size: 2em; margin-bottom: 1rem;">üì≠</div>';
                        html += '<p style="font-size: 1.1em; margin-bottom: 0.5rem;">No bookings found for ' + userEmail + '</p>';
                        html += '<p>Make a booking using the "Make Booking" tab.</p>';
                        html += '</div>';
                    } else {
                        html += '<p style="text-align: center; color: #666; padding: 2rem;">No bookings found.</p>';
                    }
                }
                
                bookingsList.innerHTML = html;
            } else {
                bookingsList.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">No bookings found.</p>';
            }
        });
    }
    
    // ========== RENDER BOOKING CARD ==========
    function renderBookingCard(booking) {
        var startTime = new Date(booking.start).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        var endTime = new Date(booking.end).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        var date = new Date(booking.start).toLocaleDateString('en-AU', {
            weekday: 'short',
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
        
        // Determine if booking is past or upcoming
        var bookingDate = new Date(booking.start);
        var now = new Date();
        var isPast = bookingDate < now;
        var isCancelled = booking.status === 'Cancelled';
        
        // Determine facility details
        var facility = booking.facility || 'clubhouse';
        var facilityIcon = 'üè†';
        var borderColor = '#3498db';
        
        if (facility === 'gazebo') {
            facilityIcon = 'üå≥';
            borderColor = '#27ae60';
        } else if (facility === 'recroom') {
            facilityIcon = 'üéÆ';
            borderColor = '#9b59b6';
        }
        
        var facilityName = booking.facilityName || 
                         (facility === 'clubhouse' ? 'Clubhouse' : 
                          facility === 'gazebo' ? 'Gazebo' : 
                          'Rec Room');
        
        // GET THE CORRECT EVENT TITLE
        // Priority: title > purpose > description > "Event"
        var eventTitle = booking.title || 
                        booking.purpose || 
                        booking.description || 
                        'Event Booking';
        
        var html = '';
        
        // Public view - limited information
        if (currentViewMode === 'public') {
            var statusBadge = '';
            var statusIcon = '‚úÖ';
            
            if (isCancelled) {
                statusBadge = '<span class="status-badge status-cancelled">CANCELLED</span>';
                statusIcon = '‚ùå';
            } else if (isPast) {
                statusBadge = '<span class="status-badge status-past">PAST</span>';
                statusIcon = '‚è∞';
            } else {
                statusBadge = '<span class="status-badge status-booked">BOOKED</span>';
                statusIcon = '‚úÖ';
            }
            
            html += '<div style="background: white; border-left: 4px solid ' + borderColor + '; padding: 1rem; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);' + (isCancelled ? ' opacity: 0.6;' : '') + '">';
            
            html += '<div style="display: flex; align-items: center; justify-content: space-between;">';
            html += '<div>';
            html += '<div style="display: flex; align-items: center; gap: 0.5rem;">';
            html += '<span style="font-size: 1.2em;">' + facilityIcon + '</span>';
            html += '<span style="font-weight: bold;">' + facilityName + '</span>';
            html += statusBadge;
            html += '</div>';
            html += '<div style="color: #666; font-size: 0.9rem; margin-top: 0.25rem;">';
            html += '<span>' + date + '</span>';
            html += '<span style="margin: 0 0.5rem;">‚Ä¢</span>';
            html += '<span>' + startTime + ' - ' + endTime + '</span>';
            html += '</div>';
            html += '</div>';
            
            html += '<div style="font-size: 1.5em;">' + statusIcon + '</div>';
            html += '</div>';
            
            html += '</div>';
            return html;
        }
        
        // Personal/Admin view - full information
        var additionalClass = '';
        if (isCancelled) {
            additionalClass = 'booking-cancelled';
        } else if (isPast) {
            additionalClass = 'booking-past';
        }
        
        html += '<div style="background: white; border-left: 4px solid ' + borderColor + '; padding: 1rem; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);" class="' + additionalClass + '">';
        
        // Facility header
        html += '<div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">';
        html += '<div style="display: flex; align-items: center; gap: 0.5rem;">';
        html += '<span style="font-size: 1.2em;">' + facilityIcon + '</span>';
        html += '<span style="font-weight: bold; font-size: 0.95em;">' + facilityName + '</span>';
        
        // STATUS BADGE
        if (isCancelled) {
            html += '<span class="status-badge status-cancelled">CANCELLED</span>';
        } else if (isPast) {
            html += '<span class="status-badge status-past">PAST</span>';
        } else {
            html += '<span class="status-badge status-booked">UPCOMING</span>';
        }
        html += '</div>';
        
        // Admin indicator
        if (currentViewMode === 'admin') {
            html += '<span style="background: #fff3cd; color: #856404; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8em; font-weight: bold;">üõ†Ô∏è ADMIN VIEW</span>';
        }
        html += '</div>';
        
        // Event title
        var titleClass = isCancelled ? 'booking-title' : '';
        html += '<div style="font-weight: bold; margin-bottom: 0.75rem; font-size: 1.1em;" class="' + titleClass + '">' + eventTitle + '</div>';
        
        // Date and time
        html += '<div style="color: #666; font-size: 0.9rem; margin-bottom: 0.5rem; line-height: 1.4;">';
        html += '<div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">';
        html += '<span style="font-size: 0.9em;">üìÖ</span>';
        html += '<span>' + date + '</span>';
        html += '</div>';
        html += '<div style="display: flex; align-items: center; gap: 0.5rem;">';
        html += '<span style="font-size: 0.9em;">üïê</span>';
        html += '<span>' + startTime + ' - ' + endTime + '</span>';
        html += '</div>';
        html += '</div>';
        
        // Personal details (only in personal/admin views)
        if (currentViewMode === 'personal' || currentViewMode === 'admin') {
            html += '<div style="background: #f8f9fa; padding: 0.75rem; border-radius: 4px; margin-bottom: 0.75rem;">';
            html += '<div style="font-size: 0.9em; color: #555;">';
            
            // Show requestor
            html += '<div><strong>Requestor:</strong> ' + (booking.residentName || 'N/A') + '</div>';
            
            if (currentViewMode === 'admin') {
                html += '<div><strong>Email:</strong> ' + (booking.residentEmail || 'N/A') + '</div>';
                
                // Show unit number if available
                if (booking.unitNumber && booking.unitNumber !== 'N/A') {
                    html += '<div><strong>Unit:</strong> ' + booking.unitNumber + '</div>';
                }
            }
            
            html += '</div>';
            html += '</div>';
        }
        
        // Booking ID
        if (booking.bookingId) {
            html += '<div style="font-size: 0.8em; color: #888; margin-bottom: 0.75rem; background: #f8f9fa; padding: 0.4rem 0.6rem; border-radius: 4px; word-break: break-all;">';
            html += 'Booking ID: ' + booking.bookingId;
            html += '</div>';
        }
        
        // CANCEL BUTTON - Only show for upcoming, non-cancelled bookings with permission
        if (!isCancelled && !isPast) {
            var showCancelButton = false;
            var cancelButtonStyle = '';
            
            if (currentViewMode === 'admin') {
                showCancelButton = true;
                cancelButtonStyle = 'btn-danger';
            } else if (currentViewMode === 'personal' && booking.residentEmail && 
                      booking.residentEmail.toLowerCase() === userEmail.toLowerCase()) {
                showCancelButton = true;
                cancelButtonStyle = 'btn-secondary';
            }
            
            if (showCancelButton) {
                html += '<div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee;">';
                html += '<button class="btn btn-small ' + cancelButtonStyle + ' cancel-btn" data-booking-id="' + booking.bookingId + '" style="width: 100%;">';
                html += '‚ùå Cancel Booking';
                html += '</button>';
                html += '</div>';
            }
        }
        
        html += '</div>';
        return html;
    }
    
    // ========== HELPER FUNCTIONS ==========
    function showLoading(show) {
        var loading = document.getElementById('loading');
        if (loading) {
            loading.style.display = show ? 'block' : 'none';
        }
    }
    
    function showMessage(text, type) {
        var message = document.getElementById('message');
        if (message) {
            message.textContent = text;
            message.className = 'message message-' + type;
            message.style.display = 'block';
            
            setTimeout(function() {
                message.style.display = 'none';
            }, 5000);
        }
    }
    
    function callAPI(action, data, callback) {
        showLoading(true);
        
        var url = BACKEND_URL + '?action=' + encodeURIComponent(action);
        
        // Add data as URL parameters
        Object.keys(data).forEach(function(key) {
            url += '&' + encodeURIComponent(key) + '=' + encodeURIComponent(data[key]);
        });
        
        // Add timestamp to prevent caching
        url += '&_t=' + Date.now();
        
        // Create callback function
        var callbackName = 'callback_' + Date.now() + '_' + Math.random().toString(36).substr(2);
        window[callbackName] = function(response) {
            showLoading(false);
            if (callback) callback(response);
            delete window[callbackName];
        };
        
        url += '&callback=' + callbackName;
        
        // Create and append script
        var script = document.createElement('script');
        script.src = url;
        script.onerror = function() {
            showLoading(false);
            showMessage('‚ùå Failed to connect to server. Please try again.', 'error');
            if (callback) callback({success: false, error: 'Network error'});
        };
        
        document.head.appendChild(script);
    }
    
    // Add your existing booking system functions here (checkAvailability, submitBooking, etc.)
    // They remain exactly as they were in your original working version
    
    </script>
</body>
</html>